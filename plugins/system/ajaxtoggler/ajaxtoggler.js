/**
 * @package		AJAX Toggler
 * @copyright	Copyright (C) 2009 - 2014 AlterBrains.com. All rights reserved.
 * @license		Commercial
 */
var AjaxToggler={options:{base:null,menu:true,toolbarTasks:["publish","unpublish","featured","archive","checkin","trash","delete","rebuild","duplicate","refresh"]},form:null,current_task:null,wrapper:null,overlay:null,semafor:null,initialize:function(e){jQuery.extend(this.options,e);this.parseForm(document.adminForm)},parseForm:function(e){if(!e||!e.task||!e.boxchecked||!jQuery(e).find("table.table.table-striped")){return}this.form=e;this.current_task=e.task.value;if(typeof this.form["jatoggler"]==="undefined"){this.semafor=jQuery('<input type="hidden" name="jatoggler" value="0" />').appendTo(this.form)}this.parseJoomla()},parseJoomla:function(){window.Joomla.submitform=function(e,t){this.submitForm(e,t)}.bind(this);window.Joomla.tableOrdering=function(e,t,n,r){this.tableOrdering(e,t,n,r)}.bind(this);window.listItemTask=function(e,t){this.listItemTask(e,t)}.bind(this);if(jQuery(".js-stools").length){jQuery("a.js-stools-column-order").click(function(e){e.preventDefault();e.stopImmediatePropagation();if(e.target.tagName!="A"){var t=jQuery(e.target).parent()}else{var t=jQuery(e.target)}var n=t.attr("data-order");var r=t.attr("data-direction");jQuery("#list_fullordering").val(n+" "+r).trigger("liszt:updated");if(jQuery.ui==undefined&&(n.indexOf("lft")>-1||n.indexOf("ordering")>-1)){jQuery("<link>").appendTo(jQuery("head")).attr({type:"text/css",rel:"stylesheet"}).attr("href",this.options.base+"media/jui/css/sortablelist.css");jQuery.loadScript(this.options.base+"media/jui/js/jquery.ui.core.js",function(){if(jQuery.JSortableList==undefined){jQuery.loadScript(this.options.base+"media/jui/js/jquery.ui.sortable.js",function(){jQuery.loadScript(this.options.base+"media/jui/js/sortablelist.js",function(){this.tableOrdering(n,r,"",null)}.bind(this))}.bind(this))}}.bind(this))}else{this.tableOrdering(n,r,"",null)}}.bind(this))}},createWrapper:function(){if(!this.wrapper){this.getTable().wrap('<div id="ajaxtogglerWrapper"></div>');this.wrapper=jQuery("#ajaxtogglerWrapper")}},createOverlay:function(e){document.body.style.cursor="wait";if(jQuery(e).length){this.overlayFx=jQuery(e).fadeTo(100,.2);this.overlay=jQuery('<div id="ajaxtogglerOverlay"></div>').appendTo("body").css({background:"transparent",position:"absolute",zIndex:"99999",left:jQuery(e).position().left+"px",top:jQuery(e).position().top+"px",width:jQuery(e).width()+"px",height:jQuery(e).height()+"px",textAlign:"center",overflow:"hidden"});var t=parseInt(jQuery(e).height()/3-25);this.overlay.html('<div class="progress progress-striped active" style="width:30%; margin:'+t+'px auto 0 auto"><div class="bar" style="width:100%;"></div></div>')}},removeOverlay:function(){document.body.style.cursor="";if(this.overlay){this.overlayFx.fadeTo(100,1);this.overlay.remove()}},getTable:function(){return jQuery(this.form).find("table.table.table-striped")},submitForm:function(e,t){if(typeof e!=="undefined"&&e!==""){var n=e;if(n.indexOf(".")!=-1){n=n.split(".")[1];if(jQuery.inArray(n,this.options.toolbarTasks)>-1){this.form.task.value=e;this.loadForm();return false}}this.form.task.value=e;if(typeof this.form.onsubmit=="function"){this.form.onsubmit()}if(typeof this.form.fireEvent=="function"){this.form.fireEvent("submit")}this.form.submit();return}this.loadForm();return false},tableOrdering:function(e,t,n,r){if(typeof r==="undefined"||r===null){r=this.form}if(r.filter_order!=undefined){this.form.filter_order.value=e}if(r.filter_order_Dir!=undefined){this.form.filter_order_Dir.value=t}if(jQuery("#sortTable")){jQuery("#sortTable").val(e).trigger("liszt:updated")}if(jQuery("#directionTable")){jQuery("#directionTable").val(t).trigger("liszt:updated")}this.form.task.value=n;this.loadForm();return false},listItemTask:function(e,t){var n=document.adminForm;var r=n[e];if(r){for(var i=0;true;i++){var s=n["cb"+i];if(!s)break;s.checked=false}r.checked=true;n.boxchecked.value=1;this.form.task.value=t;this.loadForm()}return false},loadForm:function(){this.createWrapper();this.createOverlay(this.wrapper);this.semafor.val(1);jQuery.ajax({type:"POST",url:this.form.action,cache:false,data:jQuery(this.form).serialize(),context:this}).done(function(e){jQuery("#ajaxtogglerWrapper").html(e);this.semafor.val(0);this.form.task.value=this.current_task;this.form.boxchecked.value="";this.removeOverlay();this.parseForm(document.adminForm);this.checkScroll();this.checkMessages();this.checkToolbar();this.checkPagination();this.checkContext();this.checkTips()}).fail(function(){this.semafor.val(0);this.form.task.value=this.current_task;this.removeOverlay()})},checkScroll:function(){if(jQuery(this.form).position().bottom<jQuery(window).scrollTop()){window.scroll(0,0)}},checkTips:function(){jQuery(".tip-wrap").remove();jQuery("div.tooltip.fade.top").remove();if(window.Tips){var e=this.wrapper.attr("id");document.id(e).getElements(".hasTip").each(function(e){var t=e.get("title");if(t){var n=t.split("::",2);e.store("tip:title",n[0]);e.store("tip:text",n[1])}});var t=new Tips(document.id(e).getElements(".hasTip"),{maxTitleChars:50,fixed:false})}jQuery("#"+this.wrapper.attr("id")+" .hasTooltip, [rel=tooltip]").tooltip({container:false})},checkMessages:function(){if(jQuery("#jatogglerMessages")&&jQuery("#system-message-container").length){jQuery("#system-message-container").html(jQuery("#jatogglerMessages").html());jQuery("#jatogglerMessages").remove()}},checkToolbar:function(){if(jQuery("#jatogglerToolbar")&&jQuery("#toolbar").length){jQuery("#toolbar").html(jQuery("#jatogglerToolbar").html());jQuery("#jatogglerToolbar").remove()}},checkPagination:function(){if(jQuery("#jatogglerPagination")&&jQuery(".pagination.pagination-toolbar").length){jQuery(".pagination.pagination-toolbar").html(jQuery("#jatogglerPagination").html());jQuery("#jatogglerPagination").remove()}},checkContext:function(){jQuery("#"+this.wrapper.attr("id")+" .has-context").mouseenter(function(){jQuery(".btn-group",jQuery(this)).show()}).mouseleave(function(){jQuery(".btn-group",jQuery(this)).hide();jQuery(".btn-group",jQuery(this)).removeClass("open")})}};jQuery.loadScript=function(e,t,n){var r=false,i=null;if(jQuery.isFunction(t)){i=t;r=n||r}else{r=t||r;i=n||i}var s=true;jQuery('script[type="text/javascript"]').each(function(){return s=e!=jQuery(this).attr("src")});if(s){jQuery.ajax({type:"GET",url:e,success:i,dataType:"script",cache:r})}else{if(jQuery.isFunction(i)){i.call(this)}}}